<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IfcGref</title>
    <link rel="icon" type="image/x-icon"  />

    <!-- Tailwind CSS CDN (remove if you’re using @tailwind build pipeline) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: "#B0C70D",
              secondary: "#6B7280",
              secondaryLight: "rgba(0, 0, 0, 0.23)",
              dark: "#111827",
              formLabel: "#374151",
              bgLight: "#F3F3F3",
              bgLightGray: "#f1f3f4",
              bgBody: "#D1D5DB",
              nAEntry: "#a7a8ab",
              error: "#ee5253",
              sideTab: "#4B5563",
              listBg: "#f5f5f5",
              greenLight: "rgba(177, 199, 13, 0.301)",
              ligtGray: "#EEEEEE",
              darkGray: "#D1D5DB",
              lightGreen: "#FCFFE7",
            },
            fontFamily: {
              Poppins: ["Poppins", "sans-serif"],
              Inter: ["Inter", "sans-serif"],
              Quicksand: ["Quicksand", "sans-serif"],
            },
            boxShadow: {
              header:
                "0px 1px 3px rgba(0, 0, 0, 0.1), 0px 1px 2px rgba(0, 0, 0, 0.06)",
              wrapper:
                "rgb(0 0 0 / 12%) 0px 1px 6px 0px, rgb(0 0 0 / 12%) 0px 1px 6px 0px",
            },
          },
        },
      };
    </script>
  </head>

  <body
    class="min-h-screen flex flex-col justify-center items-center bg-bgLight font-Poppins text-dark p-6"
  >
    <div
      class="relative w-full max-w-lg bg-white shadow-wrapper rounded-2xl p-8 text-center"
    >
      <h1 class="text-2xl font-semibold text-dark mb-6">Upload .IFC File</h1>

      {% if error_message %}
      <p class="text-error mb-4 font-medium">{{ error_message }}</p>
      {% endif %}

      <form
        method="POST"
        action="/upload"
        enctype="multipart/form-data"
        id="upload-form"
      >
        <div
          id="drop-zone"
          class="border-2 border-dashed border-secondaryLight rounded-xl py-10 px-4 mb-6 cursor-pointer hover:bg-bgLightGray transition-colors duration-300"
        >
          <p class="text-secondary">
            Drag & drop your <span class="font-semibold text-primary">.IFC</span>
            file here, or
            <span class="text-primary font-semibold underline">click</span> to
            select it.
          </p>
          <input type="file" name="file" id="file-input" class="hidden" />
        </div>
      </form>

      <!-- Interactive Tool Card -->
      <div
        class="bg-lightGreen border-l-4 border-primary rounded-lg p-5 mb-6 text-left"
      >
        <h3 class="text-lg font-semibold text-dark mb-1">
        New: Interactive Georeferencing
        </h3>
        <p class="text-sm text-secondary mb-3">
          Skip manual coordinate entry! Visually select points on your building
          and map them to geographic locations.
        </p>
        <button
          onclick="window.location.href='/interactive'"
          class="bg-primary opacity-80 text-white px-4 py-2 rounded-md font-semibold hover:opacity-100 transition-colors duration-300"
        >
          Try Interactive Tool
        </button>
      </div>

      <!-- Loader -->
      <div
        id="loader"
        class="absolute inset-0 bg-white bg-opacity-80 flex justify-center items-center hidden"
      >
        <img
          src="{{ url_for('static', filename='images/loading.png') }}"
          alt="Loading..."
          class="w-24 h-24 animate-pulse"
        />
      </div>

      <!-- User Guide Button -->
      <div
        onclick="window.location.href='/templates/guid.html'"
        class="mt-4 inline-flex flex-col items-center cursor-pointer hover:text-primary transition-colors"
      >
        <img
          src="../static/images/info.png"
          alt="User Guide"
          class="w-10 h-10 mb-1"
        />
        <span class="text-xs font-medium">User Guide</span>
      </div>
    </div>

    <!-- Footer -->
    <footer class="mt-10 text-center">
      <div class="flex justify-center gap-8 mb-2">
        <img
          src="../static/images/logo.webp"
          class="h-10"
          alt="Logo 1"
        />
      </div>
      <p class="text-xs text-secondary">© 2025 IfcGref - TU Delft</p>
    </footer>

    <script>
      const dropZone = document.getElementById("drop-zone");
      const fileInput = document.getElementById("file-input");
      const form = document.getElementById("upload-form");
      const loader = document.getElementById("loader");

      dropZone.addEventListener("click", () => fileInput.click());
      fileInput.addEventListener("change", () => {
        if (fileInput.files.length) {
          showLoader();
          form.submit();
        }
      });
      dropZone.addEventListener("dragover", (e) => {
        e.preventDefault();
        dropZone.classList.add("bg-bgLightGray");
      });
      dropZone.addEventListener("dragleave", () =>
        dropZone.classList.remove("bg-bgLightGray")
      );
      dropZone.addEventListener("drop", (e) => {
        e.preventDefault();
        dropZone.classList.remove("bg-bgLightGray");
        const files = e.dataTransfer.files;
        if (files.length) {
          fileInput.files = files;
          showLoader();
          form.submit();
        }
      });
      function showLoader() {
        loader.classList.remove("hidden");
      }
      
      // Capture and store project_id and token from URL when the page loads
      document.addEventListener('DOMContentLoaded', function() {
        const urlParams = new URLSearchParams(window.location.search);
        const projectId = urlParams.get('project_id');
        const token = urlParams.get('token');
        
        console.log('Upload page - Current URL:', window.location.href);
        console.log('Upload page - Project ID found:', projectId);
        console.log('Upload page - Token found:', token ? 'Yes' : 'No');
        
        if (projectId) {
          sessionStorage.setItem('project_id', projectId);
          console.log('Project ID stored in session storage:', projectId);
        } else {
          const storedProjectId = sessionStorage.getItem('project_id');
          console.log('No project_id in URL, checking stored value:', storedProjectId);
        }
        
        if (token) {
          sessionStorage.setItem('auth_token', token);
          console.log('Token stored in session storage');
        } else {
          const storedToken = sessionStorage.getItem('auth_token');
          console.log('No token in URL, checking stored value:', storedToken ? 'Yes' : 'No');
        }
      });
    </script>
  </body>
</html>