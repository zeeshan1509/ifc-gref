<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quick Test - Auto Georeferencing</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background-color: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .btn { background: #007bff; color: white; border: none; padding: 12px 24px; border-radius: 4px; cursor: pointer; margin: 5px; }
        .btn:hover { background: #0056b3; }
        .btn-success { background: #28a745; }
        .btn-success:hover { background: #1e7e34; }
        .coordinates { background: #f8f9fa; padding: 15px; border-radius: 4px; margin: 10px 0; }
        .step { margin: 20px 0; padding: 15px; border-left: 4px solid #007bff; background: #f8f9fa; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Quick Test: Auto-Submit Georeferencing</h1>
        <p>This demonstrates the automatic workflow for georeferencing with pre-selected coordinates for Islamabad.</p>
        
        <div class="step">
            <h3>Step 1: Select Sample File</h3>
            <p>Choose a sample IFC file to test with:</p>
            <button class="btn" onclick="testWithFile('Ifc4_SampleHouse_0_GroundFloor.ifc')">
                üè† Test with Sample House (Ground Floor)
            </button>
            <button class="btn" onclick="testWithFile('Ifc4_SampleHouse_1_Roof.ifc')">
                üè† Test with Sample House (Roof)
            </button>
        </div>
        
        <div class="step">
            <h3>Step 2: Pre-configured Coordinates</h3>
            <p>These coordinates will be automatically submitted:</p>
            <div class="coordinates">
                <strong>Local IFC coordinates (meters):</strong><br>
                P1 = (0.000, 0.000, 0.000)<br>
                P2 = (100.000, 0.000, 0.000)<br>
                P3 = (0.000, 100.000, 0.000)<br><br>
                
                <strong>Target coordinates in EPSG:32643 (Islamabad):</strong><br>
                P1' = (319050.27, 3728873.80, 540.0)<br>
                P2' = (319150.27, 3728873.80, 540.0)<br>
                P3' = (319050.27, 3728973.80, 540.0)<br>
            </div>
        </div>
        
        <div class="step" id="result-step" style="display: none;">
            <h3>Step 3: Results</h3>
            <p>The coordinates have been automatically submitted. The georeferenced file should now be ready for viewing on the map.</p>
            <button class="btn btn-success" id="view-on-map-btn" onclick="viewOnMap()">
                üó∫Ô∏è View on Map
            </button>
        </div>
    </div>

    <script>
        let currentFilename = '';
        
        function testWithFile(filename) {
            currentFilename = filename;
            
            // Set pre-configured coordinates for Islamabad
            const testData = {
                buildingPoints: [
                    { building: { x: 0.000, y: 0.000, z: 0.000 } },
                    { building: { x: 100.000, y: 0.000, z: 0.000 } },
                    { building: { x: 0.000, y: 100.000, z: 0.000 } }
                ],
                mapPoints: [
                    { coordinates: { easting: 319050.27, northing: 3728873.80, elevation: 540.0 } },
                    { coordinates: { easting: 319150.27, northing: 3728873.80, elevation: 540.0 } },
                    { coordinates: { easting: 319050.27, northing: 3728973.80, elevation: 540.0 } }
                ],
                epsg: '32643',
                filename: filename
            };
            
            // Store data for auto-population
            sessionStorage.setItem('interactiveGeorefData', JSON.stringify(testData));
            
            // Show loading and redirect
            alert(`Testing with ${filename}\\n\\nThe coordinates will be automatically submitted for georeferencing.`);
            
            // Redirect to the conversion process
            window.location.href = `/convert/${filename}`;
        }
        
        function viewOnMap() {
            if (currentFilename) {
                // Create form to view on map (simulating the "Show on Map" button)
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = `/show/${currentFilename}`;
                document.body.appendChild(form);
                form.submit();
            }
        }
        
        // Check if we're returning from a successful georeferencing
        window.addEventListener('load', function() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('success') === 'true') {
                document.getElementById('result-step').style.display = 'block';
                currentFilename = urlParams.get('filename');
            }
        });
    </script>
</body>
</html>
